<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Pen Pals</title>


  <!-- Compiled and minified CSS -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/AlexVentura/4d0c725c34941fa42361350dcb43731f/raw/e7eba7b9603237a8e4623f305abc46e60908d146/sponsor.matchxperience.css">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/animate.css') }}">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">

  <!-- Compiled and minified JavaScript -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.rawgit.com/Dogfalo/materialize/v1-dev/extras/noUiSlider/nouislider.min.js"></script>
  

</head>
<body>

<div class="row">
    <div class="col s2">
		<form id="search_form" method="post">
			<span class="flow-text"><i class="small material-icons" id="search-icon">search</i>Search</span>
			<br>
			<h3 class="flow-text" id="search-text">By favorite book genres:</h3>
			<div class="chips-autocomplete-genre text-darken-2"></div>
			<h3 class="flow-text" id="search-text">By favorite book titles:</h3>
			<div class="chips-autocomplete-book text-darken-2" name="title"></div>
			
			<h3 class="flow-text" id="age-text">By age:</h3>
			<div id="slider"></div>
			<h6 id="age-default">(defaults to 18,100)</h6>
			<button id="search-button" class="btn waves-effect waves-light secondary-color" type="button" name="button" onclick="search();">Search</button>


		</form>
	</div>
    <div class="col s10" >
		<div class="row">
			<section class="search-card-container" id="search-container">

			</section>
		</div>
		
	</div>
</div>

<div class="row">
	<a href="{{ url_for('auth.logout') }}">log out</a>
    <a href="{{ url_for('main.bio') }}">View Bio</a>
    <a href="{{ url_for('main.create_bio') }}">Create Bio</a>
    <a href="{{url_for('main.home')}}">Home</a>
</div>
<!-- Footer Section -->
	<footer class="page-footer white">	
		<div class="footer-copyright">
			<p id="copyright">copyrighted mother effers</p>
		</div>
	</footer>


  <!--  Scripts-->

  </body>
<script type="text/javascript">
function search(){
	var cards = $();
	genres = M.Chips.getInstance($('.chips-autocomplete-genre'));

	names = {};
	for (x in genres.chipsData) {
		names[x] = genres.chipsData[x].tag
	}
	$.ajax({
		url: '/main/search',
		data: {
			'names' : JSON.stringify(names)
		},
		type: 'POST',
		success: function(response) {
			$("#search-container").html("");
			var obj = JSON.parse(response);				
			for (userIndex in obj) {
				user = obj[userIndex]
				cards = cards.add(createCard(user));
			}
			$('#search-container').append(cards);
		},
		error: function(error) {
			console.log(error);
        }
    });
}

function createCard(cardData) {
  var cardTemplate = [
    '<article class="card search-card">',
    '<figure class="card__thumbnail">',
    '<img src="https://amp.businessinsider.com/images/5899ffcf6e09a897008b5c04-750-750.jpg" width="50%" >',
    '</figure>',
	'<header class="card__title">',
    '<h3>',
	cardData.first + " ",
	cardData.last,
	'</h3>',
    '</header>',
    '<main class="card__description">',
    'Lorem Ipsum dolor amet sun Lorem Ipsum dolor amet sun Lorem Ipsum dolor amet sun',
    '</main>',
    '</article>'
  ];

  // a jQuery node
  return $(cardTemplate.join(''));
}
</script>
<script>
$(document).ready(function(){

	var slider = document.getElementById('slider');
	  noUiSlider.create(slider, {
	   start: [18, 110],
	   connect: true,
	   step: 1,
	   range: {
		 'min': 0,
		 'max': 100
	   },
	   format: wNumb({
		 decimals: 0
	   })
	});

	$('.chips-autocomplete-genre').chips({
		secondaryPlaceholder: '+genre',
		placeholder: 'Search by genre',
		autocompleteOptions: {
			data: {
				'Mystery': null,
				'Horror': null,
				'Adventure': null,
				'a@gmail.com' : null
			},
			limit: Infinity,
			minLength: 1
		}
	});
	
	$('.chips-autocomplete-book').chips({
		secondaryPlaceholder: '+title',
		placeholder: 'Search by book',
		autocompleteOptions: {
			data: {
			'Catcher in the rye': null,
			'Horror': null,
			'Adventure': null,
			},
			limit: Infinity,
			minLength: 1
		}
	});
});


/*    
        jsonGenres = json.loads(request.form['names'])
        genres = []
        for x in jsonGenres:
            genres.append(jsonGenres[x])
        str = '%' + genres[0] + '%'
        users = db.execute(
            'SELECT * FROM user WHERE genres LIKE ?', (str,)
        ).fetchall()
        cursor = db.execute('select * from user')
        header = [x[0] for x in cursor.description]
        users_obj = {}
        for user in users:
            users_obj[user["id"]] = dict(zip(header,user))
        y = json.dumps(users_obj)
        return jsonify(y)
*/
</script>





</html>
