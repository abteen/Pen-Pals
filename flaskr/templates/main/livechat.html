<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="referrer" content="no-referrer"/>
  <title>Pen Pals</title>


  <!-- Compiled and minified CSS -->
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.0/css/materialize.min.css">
  <link rel="stylesheet" href="https://cdn.rawgit.com/AlexVentura/4d0c725c34941fa42361350dcb43731f/raw/e7eba7b9603237a8e4623f305abc46e60908d146/sponsor.matchxperience.css">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/animate.css') }}">
  <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='styles/style.css') }}">

  <!-- Compiled and minified JavaScript -->
  <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
  <script src="https://cdn.rawgit.com/Dogfalo/materialize/v1-dev/extras/noUiSlider/nouislider.min.js"></script>

  <script type="text/javascript">
function noenter() {
  return !(window.event && window.event.keyCode == 13); }
</script>
</head>



<button id="send-button" class="btn waves-effect waves-light secondary-color" name="button" onclick="submit();">bang</button>

<form id="message_form" method="post">
<div class="input-field col m12">
  <input id="message"  name="mesg" onkeypress="return noenter()">
  <label for="message"> </label>
</div>
</form>

<script>
console.log("im being called");
$.ajax({
       url: '/main/livechat',
       data:  {
   			'otherEmail' : localStorage.getItem("storedEmail"),
        'flag' : 0
   		},
       type: 'POST',
       success: function(response) {
//         console.log(response);
//         console.log("no err");
//         var obj = JSON.parse(response);
//         emailself = obj[Object.keys(obj)[0]];
//         name1self = obj[Object.keys(obj)[2]];
//         name2self = obj[Object.keys(obj)[4]];
//         emailreciver = obj[Object.keys(obj)[1]];
//         namereciver = obj[Object.keys(obj)[3]];
//         name2reciver = obj[Object.keys(obj)[5]];
         console.log("no err");
       },
       error: function(error) {
           console.log("err");
       }
   });
console.log("im being called part 2");
</script>


<script type="text/javascript">

function submit(){

  form = document.forms['message_form'];
  msg = form.elements['mesg'].value;
  console.log(msg);
  console.log("im being called pt 3");
  $.ajax({
         url: '/main/livechat',
         data:  {
          'the_message' : msg,
          'otherEmail' : localStorage.getItem("storedEmail"),
          'flag' : 1
     		},
         type: 'POST',
         success: function(response) {
  //         console.log(response);
  //         console.log("no err");
  //         var obj = JSON.parse(response);
  //         emailself = obj[Object.keys(obj)[0]];
  //         name1self = obj[Object.keys(obj)[2]];
  //         name2self = obj[Object.keys(obj)[4]];
  //         emailreciver = obj[Object.keys(obj)[1]];
  //         namereciver = obj[Object.keys(obj)[3]];
  //         name2reciver = obj[Object.keys(obj)[5]];
           console.log("no err two");
         },
         error: function(error) {
             console.log("err two");
         }
     });
  console.log("im being called part 4");

}
</script>

<script>
$(document).ready(function(){
  $('#message_form').keypress(function(e){
      if(e.keyCode==13)
      $('#send-button').click();
    });
  }

</script>

<div class="row">
<div class="col s4">
<h6 class="bold">messages</h6>
</div>
</div>
{% for item in chat_history %}
<div class="row">
<div class="col s4">
<p>{{item.message}}</p>
</div>
</div>
{% endfor %}

<div class="row">
	<a href="{{ url_for('auth.logout') }}">log out</a>
    <a href="{{ url_for('main.bio') }}">View Bio</a>
    <a href="{{ url_for('main.create_bio') }}">Create Bio</a>
    <a href="{{url_for('main.home')}}">Home</a>
    <a href="{{ url_for('main.chatdb') }}">Chat database</a>
</div>
<!-- Footer Section -->
	<footer class="page-footer white">
		<div class="footer-copyright">
			<p id="copyright">copyrighted mother effers</p>
		</div>
	</footer>









</html>
